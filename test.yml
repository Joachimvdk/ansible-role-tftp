---
- hosts: all
  become: true
  vars:
    tftp_root_directory: /srv/tftp
    tftp_server_args: "--secure --create -vvv"
    tftp_setype: public_content_rw_t
    tftp_anon_write: true
  pre_tasks:
    - name: Install tools
      package:
        name: "{{ item }}"
        state: installed
      with_items:
        - tcpdump
        - tftp
  tasks:
    - name: Ensure firewall is disabled
      service:
        name: firewalld
        state: stopped
    - name: Put a file in the tftp directory that can be fetched by a client
      copy:
        content: Hello world!
        dest: "{{ tftp_root_directory }}/README"
        owner: nobody
        group: nobody
        mode: 0664
  roles:
    - tftp
